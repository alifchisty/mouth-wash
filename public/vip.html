

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dray Source</title>
    <link rel="stylesheet" href="css/style.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    <header class="Header">
        <div class="header-container">
            <div class="item"> <span id="electronic" class="money-color">0</span> <br> Team </div>
            <div class="item"><span class="money-color" id="money">0</span> <br> All above </div>
        </div>
    </header>
    <main>
        <div class="main-container">
            <div class="second-main-container">
                <div class="item box" data-cost="9000">
                    <h2 class="package-title"><i class='bx bx-candles' style='color:gold'  ></i>Reliable Investmant<i class='bx bx-candles' style='color:gold'  ></i></h2>
                    <p class="rank-buying">Copper Investmant</p>
                    <div class="buying-details">
                        <div class="info">Max 300<br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">0.1 USDT <br><span class="details">Working income</span></div>
                    </div>
                    <div class="items click"><a href="#">90 USDT Open now</a></div>
                </div>
                <div class="item1 box" data-cost="18000">
                    <p class="rank-buying">Ivory Investmant</p>
                    <div class="buying-details">
                        <div class="info">Max 600 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">0.5 USDT-cent <br><span class="details">Working income</span></div>
                    </div>
                    <div class="items click" ><a href="#">180 USDT Open now</a></div>
                </div>
                <div class="item2 box" data-cost="30000">
                    <p class="rank-buying">Amber Investmant</p>
                    <div class="buying-details">
                        <div class="info">Max 1200 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">0.83 USDT-cent<br><span class="details">Working income</span></div>
                    </div>
                    <div class="items click"><a href="#">300 USDT Open now</a></div>
                </div>
                <div class="item3 box" data-cost="60000">
                    <p class="rank-buying">Cedar Investmant</p>
                    <div class="buying-details">
                         <div class="info">Max 1200 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">1.66 USDT-cent<br><span class="details">Working income <br>
Comeing soon</span></div>
                    </div>
                    <div class="items click"><a href="#">600 USDT Open now</a></div>
                </div>
                <div class="item4 box" data-cost="120000">
                    <p class="rank-buying">Tritium  Investmant</p>
                    <div class="buying-details">
                         <div class="info">Max 1200 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">3.33 USDT-cent<br><span class="details">Working income<br>
Comeing soon</span></div>
                    </div>
                    <div class="items click"><a href="#">1200 USDT Open now</a></div>
                </div>
 <div class="item4 box" data-cost="240000">
                    <p class="rank-buying">Incense Investmant</p>
                    <div class="buying-details">
                         <div class="info">Max 1200 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">6.66 USDT-cent<br><span class="details">Working income <br>
Comeing soon</span></div>
                    </div>
                    <div class="items click"><a href="#">2400 USDT Open now</a></div>
                </div>
                <div class="item5 box" style="margin-bottom: 8.5vh;"   data-cost="300000">
                    <p class="rank-buying">Antimatter (Mega Chance) Ranking Investmant</p>
                    <div class="buying-details">
                         <div class="info">Max 1200 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">8.33 USDT-cent<br><span class="details">Working income<br>
Comeing soon</span></div>
                    </div>
                    <div class="items click"><a href="#">3000 USDT Open now</a></div>
                </div>

            </div>

        </div>
    </main>
    <footer class="container">
        <nav class="container-layer">
      <a href="/Home" class="clk"> <i class='bx bxs-home' style='color:#0c0400'></i><br>Home</a>
            <a href="/Connection" class="clk"><i class='bx bx-sitemap'style='color:#0c0b0b'></i><br>Network</a>
            <a href="/vip" class="clk vip-link"><i class='bx bxl-sketch' style='color:#0c0c0c'  ></i> <br> Invest </a>
            <a href="/mine" class="clk"><i class='bx bxs-user' style='color:#000400'></i><br> Owner</a>
            <a href="/about" class="clk"><i class='bx bx-shield' style='color:#0c0b0b'  ></i><br>About</a>
        </nav>
    </footer>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const vipuserId = urlParams.get('vipuserId');
    const packageCost = parseInt(urlParams.get('packageCost'));

    let electronic = parseInt(localStorage.getItem('electronic')) || 0;
    let score = parseInt(localStorage.getItem('score')) || 0;

    updateMoneyDisplay(score, electronic);

    if (vipuserId) {
        document.querySelectorAll('.click').forEach(box => {
            const cost = parseInt(box.closest('.box').getAttribute('data-cost'));
            const packageKey = `opened_${vipuserId}_${cost}`;
            const lastOpenedKey = `${packageKey}_time`;

            if (localStorage.getItem(packageKey)) {
                const lastOpenedTime = parseInt(localStorage.getItem(lastOpenedKey)) || 0;
                if (Date.now() - lastOpenedTime > 7776000000) { // 90 days in milliseconds
                    localStorage.removeItem(packageKey);
                    localStorage.removeItem(lastOpenedKey);
                    box.innerHTML = `<a href="#">${cost} USDT Open now</a>`;
                } else {
                    box.innerHTML = '<p>Opened for you</p>';
                }
            }

            box.addEventListener('click', (event) => {
                event.preventDefault();

                if (localStorage.getItem(packageKey)) {
                    // Check if this is the first time the package is being opened
                    const isFirstTime = !localStorage.getItem(lastOpenedKey);
                    if (isFirstTime) {
                        showReferralPrompt(vipuserId, cost);
                        return;
                    }
                    // If not the first time, redirect to income page
                    window.location.href = `/income?vipuserId=${vipuserId}&packageCost=${cost}`;
                    return;
                }

                if (electronic >= cost || score >= cost) {
                    if (electronic >= cost) {
                        electronic -= cost;
                        localStorage.setItem('electronic', electronic);
                    } else {
                        score -= cost;
                        localStorage.setItem('score', score);
                    }

                    localStorage.setItem(packageKey, 'true');
                    localStorage.setItem(lastOpenedKey, Date.now());
                    updateMoneyDisplay(score, electronic);
                    box.innerHTML = '<p>Opened for you</p>';
                    showReferralPrompt(vipuserId, cost); // Show referral prompt after opening
                } else {
                    alert('Insufficient funds to open this package.');
                }
            });
        });
    } else {
        alert('Invalid user ID');
    }

    function updateMoneyDisplay(score, electronic) {
        let scoreDollars = Math.floor(score / 100);
        let scoreCents = score % 100;
        document.getElementById('money').textContent = `${scoreDollars}.${scoreCents < 10 ? '0' + scoreCents : scoreCents}`;

        let electronicDollars = Math.floor(electronic / 100);
        let electronicCents = electronic % 100;
        document.getElementById('electronic').textContent = `${electronicDollars}.${electronicCents < 10 ? '0' + electronicCents : electronicCents}`;
    }

    function showReferralPrompt(vipuserId, cost) {
        const referralPrompt = document.createElement('div');
        referralPrompt.innerHTML = `
            <div style="background-color: green; color: black; padding: 10px; border-radius: 5px; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;">
                <p style="color: gold;">Referred User ID</p>
                <input type="text" style="color: black;" id="referredUserId" placeholder="Enter user ID">
                <button id="submitReferral" style="background: linear-gradient(to right, #ff7e5f, #feb47b); color: white;">Submit</button>
            </div>
        `;
        document.body.appendChild(referralPrompt);

        document.getElementById('submitReferral').addEventListener('click', () => {
            const referredUserId = document.getElementById('referredUserId').value;
            if (referredUserId) {
                // Check if the referredUserId exists in the database
                fetch(`/api/checkUserId?userId=${referredUserId}`)
                    .then(res => {
                        // Log the response for debugging
                        console.log('Response:', res);
                        return res.json();
                    })
                    .then(data => {
                        if (data.exists) {
                            // Submit referral
                            fetch('/api/setReferral', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ userId: vipuserId, referredUserId })
                            }).then(res => res.json())
                              .then(data => {
                                  if (data.success) {
                                      referralPrompt.innerHTML = '<p style="background-color: green; color: black;">Successfully opened for you</p>';
                                      setTimeout(() => {
                                          referralPrompt.remove();
                                          window.location.href = `/income?vipuserId=${vipuserId}&packageCost=${cost}`;
                                      }, 800);
                                  } else {
                                      alert('Error setting referral.');
                                  }
                              });
                        } else {
                            alert('User ID does not exist.');
                        }
                    })
                    .catch(error => {
                        console.error('Fetch error:', error);
                        alert('An error occurred while checking the user ID.');
                    });
            }
        });
    }

    document.querySelector('.vip-link').addEventListener('click', (event) => {
        event.preventDefault();

        const vipuserId = localStorage.getItem('userId');
        if (vipuserId) {
            window.location.href = `/vip?vipuserId=${vipuserId}`;
        } else {
            alert('Invalid user ID');
        }
    });
});
</script>

{{!-- <script>
document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const vipuserId = urlParams.get('vipuserId');

    let electronic = parseInt(localStorage.getItem('electronic')) || 0;
    let electronicDollars = Math.floor(electronic / 100);
    let electronicCents = electronic % 100;
    document.getElementById('electronic').textContent = `${electronicDollars}.${electronicCents < 10 ? '0' + electronicCents : electronicCents}`;

    let score = parseInt(localStorage.getItem('score')) || 0;
    updateMoneyDisplay(score, electronic);

    if (vipuserId) {
        document.querySelectorAll('.click').forEach(box => {
            const cost = parseInt(box.closest('.box').getAttribute('data-cost'));
            const packageKey = `opened_${vipuserId}_${cost}`;
            const lastOpenedKey = `${packageKey}_time`;
            const dailyLimitKey = `daily_limit_${vipuserId}_${cost}`;
            const earnedKey = `earned_${vipuserId}_${cost}`;

            if (localStorage.getItem(packageKey)) {
                const lastOpenedTime = parseInt(localStorage.getItem(lastOpenedKey)) || 0;
                if (Date.now() - lastOpenedTime > 7776000000) { // 90 days in milliseconds
                    localStorage.removeItem(packageKey);
                    localStorage.removeItem(lastOpenedKey);
                    localStorage.removeItem(dailyLimitKey);
                    localStorage.removeItem(earnedKey);
                    box.innerHTML = `<a href="#">${cost} USDT Open now</a>`;
                } else {
                    box.innerHTML = '<p>Opened for you</p>';
                }
            }

            box.addEventListener('click', (event) => {
                event.preventDefault();

                if (localStorage.getItem(packageKey)) {
                    window.location.href = `/income?vipuserId=${vipuserId}&packageCost=${cost}`;
                    return;
                }

                if (electronic >= cost || score >= cost) {
                    if (electronic >= cost) {
                        electronic -= cost;
                        localStorage.setItem('electronic', electronic);
                    } else {
                        score -= cost;
                        localStorage.setItem('score', score);
                    }

                    localStorage.setItem(packageKey, 'true');
                    localStorage.setItem(lastOpenedKey, Date.now());
                    localStorage.setItem(dailyLimitKey, 0); // Initialize daily limit
                    localStorage.setItem(earnedKey, 0);
                    updateMoneyDisplay(score, electronic);
                    box.innerHTML = '<p>Opened for you</p>';
                    window.location.href = `/income?vipuserId=${vipuserId}&packageCost=${cost}`;
                } else {
                    alert('Insufficient funds to open this package.');
                }
            });
        });
    } else {
        alert('Invalid user ID');
    }
});

function updateMoneyDisplay(score, electronic) {
    let scoreDollars = Math.floor(score / 100);
    let scoreCents = score % 100;
    document.getElementById('money').textContent = `${scoreDollars}.${scoreCents < 10 ? '0' + scoreCents : scoreCents}`;

    let electronicDollars = Math.floor(electronic / 100);
    let electronicCents = electronic % 100;
    document.getElementById('electronic').textContent = `${electronicDollars}.${electronicCents < 10 ? '0' + electronicCents : electronicCents}`;
}

function getDailyLimit(cost) {
                switch (cost) {
                    case 9000: return 300;
                    case 18000: return 300;
                    case 30000: return 200;
                    case 60000: return 200;
                    case 120000: return 400;

                    default: return 300;
                }
            }

document.querySelector('.vip-link').addEventListener('click', (event) => {
    event.preventDefault();

    const vipuserId = localStorage.getItem('userId');
    if (vipuserId) {
        window.location.href = `/vip?vipuserId=${vipuserId}`;
    } else {
        alert('Invalid user ID');
    }
});
</script> --}}
</body>

</html>